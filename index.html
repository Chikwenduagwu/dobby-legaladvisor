<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Dobby Legal Advisor</title>
  <style>
    body { font-family: Arial, sans-serif; background: #fff; padding: 20px; }
    #chat { max-width: 700px; margin: auto; border: 1px solid #ddd; padding: 20px; border-radius: 10px; }
    .msg { margin: 10px 0; }
    .user { font-weight: bold; color: #333; }
    .bot { color: #007BFF; white-space: pre-line; }
    input, button { padding: 10px; margin-top: 10px; }
    button { background: orange; border: none; border-radius: 6px; cursor: pointer; }
    button:hover { background: darkorange; }
  </style>
</head>
<body>
  <div id="chat">
    <h2>‚öñÔ∏è Dobby Legal Advisor</h2>
    <div id="messages"></div>
    <input type="text" id="userInput" placeholder="Ask for legal advice...">
    <button onclick="getAdvice()">Ask</button>
  </div>

  <script>
    async function getAdvice() {
      const input = document.getElementById("userInput").value;
      if (!input) return;

      const messages = document.getElementById("messages");
      messages.innerHTML += `<div class="msg user">üßë: ${input}</div>`;

      // Call our Vercel proxy
      try {
        const res = await fetch(`/api/law?query=${encodeURIComponent(input)}`);
        const data = await res.json();

        // Now call Fireworks AI (Dobby) to interpret in Pidgin
        const fwRes = await fetch("https://api.fireworks.ai/inference/v1/completions", {
          method: "POST",
          headers: {
            "Authorization": "Bearer fw_3ZYt5vRJztdY1fXajRko5YCt",
            "Content-Type": "application/json"
          },
          body: JSON.stringify({
            model: "accounts/sentientfoundation-serverless/models/dobby-mini-unhinged-plus-llama-3-1-8b",
            prompt: `You be lawyer wey sabi pidgin. Client ask: "${input}". 
Here be law data wey I find: ${JSON.stringify(data)}. 
Explain am well for Pidgin, gimme advice like real lawyer.`,
            max_tokens: 300
          })
        });

        const fwData = await fwRes.json();
        const botReply = fwData.choices?.[0]?.text || "No reply from AI.";

        typeEffect(botReply, messages);
      } catch (err) {
        messages.innerHTML += `<div class="msg bot">‚ùå Error: ${err.message}</div>`;
      }
    }

    // Typing effect for AI messages
    function typeEffect(text, container) {
      let i = 0;
      const msg = document.createElement("div");
      msg.className = "msg bot";
      container.appendChild(msg);

      function typing() {
        if (i < text.length) {
          msg.textContent += text.charAt(i);
          i++;
          setTimeout(typing, 30);
        }
      }
      typing();
    }
  </script>
</body>
</html>
